{% extends 'mediaapp/base.html' %}

{% block title %}Recovery Vault â€” Picha Yangu{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2>ðŸ”„ Recovery Vault</h2>
  <small class="text-muted">Recover deleted files before they expire</small>
</div>

{% if deleted_files %}
  <div class="table-responsive">
    <table class="table table-hover">
      <thead class="table-light">
        <tr>
          <th>File</th>
          <th>Client / Project</th>
          <th>Type</th>
          <th>Deleted</th>
          <th>Expires</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for entry in deleted_files %}
          {% with media=entry.media %}
            <tr>
              <td>
                <strong>{{ media.file.name|truncatewords:3 }}</strong>
              </td>
              <td>
                {{ media.project.client.name }} / {{ media.project.name }}
              </td>
              <td>
                <span class="badge bg-info">{{ media.get_media_type_display }}</span>
              </td>
              <td>{{ entry.deleted_at|date:"M d, Y H:i" }}</td>
              <td>
                {% if entry.is_expired %}
                  <span class="badge bg-danger">Expired</span>
                {% else %}
                  <span class="badge bg-warning">{{ entry.expiry|date:"M d, Y" }}</span>
                {% endif %}
              </td>
              <td>
                {% if not entry.is_expired %}
                  <button class="btn btn-sm btn-success" onclick="restore({{ media.id }})">Restore</button>
                {% else %}
                  <span class="text-muted">â€”</span>
                {% endif %}
              </td>
            </tr>
          {% endwith %}
        {% endfor %}
      </tbody>
    </table>
  </div>
{% else %}
  <div class="alert alert-success">Your Recovery Vault is empty. Keep creating great content!</div>
{% endif %}

<script>
  async function restore(id) {
    if (confirm('Restore this file?')) {
      const res = await fetch(`/api/media/${id}/restore/`, { method: 'POST' });
      if (res.ok) {
        alert('File restored!');
        location.reload();
      } else {
        alert('Restore failed.');
      }
    }
  }
</script>
{% endblock %}
